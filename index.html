<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus CRM - Minimalist & Powerful</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Phosphor Icons for minimalist beautiful icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Chart.js for Forecast Graph -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div id="app" class="app-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="ph-fill ph-planet"></i> Nexus CRM
                </div>
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#pipeline" class="nav-link active" data-target="pipeline-view">
                        <i class="ph ph-kanban"></i> Pipeline
                    </a>
                </li>
                <li>
                    <a href="#contacts" class="nav-link" data-target="contacts-view">
                        <i class="ph ph-users"></i> Contacts
                    </a>
                </li>
                <li>
                    <a href="#settings" class="nav-link" data-target="settings-view">
                        <i class="ph ph-gear"></i> Settings
                    </a>
                </li>
            </ul>
            <div class="sidebar-footer">
                <button id="add-btn-global" class="btn btn-primary btn-full-width">
                    <i class="ph ph-plus-circle"></i> New Item
                </button>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="mobile-top-bar">
                <div class="logo">
                    <i class="ph-fill ph-planet"></i> Nexus CRM
                </div>
                <button id="mobile-menu-btn" class="btn-icon" onclick="app.handlers.toggleSidebar()">
                    <i class="ph ph-list" style="font-size: 1.5rem;"></i>
                </button>
            </div>
            <!-- Pipeline View (Kanban) -->
            <section id="pipeline-view" class="view-section active">
                <header class="view-header">
                    <div>
                        <h1>Sales Pipeline</h1>
                        <p class="subtitle">Track your active deals and close more business.</p>
                    </div>
                    <div class="header-actions">
                        <button id="deal-insights-btn" class="btn btn-ai"><i class="ph-fill ph-magic-wand"></i> AI
                            Insights</button>
                        <button class="btn btn-primary" onclick="app.handlers.openDealModal()"><i
                                class="ph ph-plus"></i> Add Deal</button>
                    </div>
                </header>

                <!-- Forecast Dashboard Container -->
                <div class="dashboard-top-row">
                    <div class="dashboard-title">Revenue Forecast Chart</div>
                    <div class="canvas-container">
                        <canvas id="forecast-chart"></canvas>
                    </div>
                </div>

                <div class="kanban-board">
                    <!-- Columns will be injected by JS -->
                </div>
            </section>

            <!-- Contacts View -->
            <section id="contacts-view" class="view-section">
                <header class="view-header">
                    <div>
                        <h1>Contacts</h1>
                        <p class="subtitle">Manage relationships and interactions.</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-bar">
                            <i class="ph ph-magnifying-glass"></i>
                            <input type="text" id="contact-search" placeholder="Search contacts...">
                        </div>
                        <button class="btn btn-primary" onclick="app.handlers.openContactModal()"><i
                                class="ph ph-plus"></i> Add Contact</button>
                    </div>
                </header>
                <div class="contacts-list">
                    <!-- Table will be injected by JS -->
                </div>
            </section>

            <!-- Settings View -->
            <section id="settings-view" class="view-section">
                <header class="view-header">
                    <div>
                        <h1>Settings</h1>
                        <p class="subtitle">Configure your CRM and AI preferences.</p>
                    </div>
                </header>
                <div class="settings-container panel">
                    <h2>AI Integration</h2>
                    <p class="settings-desc">Nexus CRM uses the Gemini API to supercharge your workflow. Your key is
                        stored securely in this browser's local storage and never sent to a third-party server besides
                        Google.</p>

                    <form id="settings-form">
                        <div class="form-group">
                            <label for="setting-api-key">Gemini API Key</label>
                            <input type="password" id="setting-api-key" placeholder="AIzaSy...">
                        </div>

                        <div class="settings-actions">
                            <button type="submit" class="btn btn-primary">Save Settings</button>
                        </div>
                    </form>

                    <h2 class="mt-4">Data Management</h2>
                    <p class="settings-desc">Export your entire CRM database as a JSON file, or import an existing
                        backup.</p>
                    <div class="data-actions">
                        <button id="export-btn" class="btn btn-secondary"><i class="ph ph-download-simple"></i> Export
                            JSON</button>
                        <button id="import-btn" class="btn btn-outline"
                            onclick="document.getElementById('import-file').click()"><i class="ph ph-upload-simple"></i>
                            Import JSON</button>
                        <input type="file" id="import-file" style="display: none" accept=".json">
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modals Overlay -->
    <div id="modal-overlay" class="modal-overlay"></div>

    <!-- Contact Modal -->
    <div id="contact-modal" class="modal">
        <div class="modal-header">
            <h2 id="contact-modal-title">Add Contact</h2>
            <button class="btn-icon close-modal"><i class="ph ph-x"></i></button>
        </div>
        <form id="contact-form" class="modal-body">
            <input type="hidden" id="contact-id">
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="contact-name" required>
            </div>
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="contact-email">
            </div>
            <div class="form-group">
                <label>Company</label>
                <input type="text" id="contact-company">
            </div>
            <div class="form-group">
                <label>Phone</label>
                <input type="text" id="contact-phone">
            </div>
            <div class="form-group">
                <label>Mobile</label>
                <input type="text" id="contact-mobile">
            </div>
            <div class="form-group">
                <label>Preferred Contact Method</label>
                <select id="contact-preferred">
                    <option value="email">Email</option>
                    <option value="phone">Phone</option>
                    <option value="mobile">Mobile</option>
                </select>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="contact-notes" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Contact</button>
            </div>
        </form>
    </div>

    <!-- Deal Modal -->
    <div id="deal-modal" class="modal">
        <div class="modal-header">
            <h2 id="deal-modal-title">Add Deal</h2>
            <button class="btn-icon close-modal"><i class="ph ph-x"></i></button>
        </div>
        <form id="deal-form" class="modal-body">
            <input type="hidden" id="deal-id">
            <div class="form-group">
                <label>Deal Title</label>
                <input type="text" id="deal-title" required>
            </div>
            <div class="form-group">
                <label>Value ($)</label>
                <input type="number" id="deal-value" required aria-label="Amount in USD">
            </div>
            <div class="form-group">
                <label>Contact</label>
                <select id="deal-contact" required>
                    <!-- Options injected -->
                </select>
            </div>
            <div class="form-group">
                <label>Stage</label>
                <select id="deal-stage" required>
                    <option value="lead">Lead</option>
                    <option value="contacted">Contacted</option>
                    <option value="negotiating">Negotiating</option>
                    <option value="won">Won</option>
                    <option value="lost">Lost</option>
                </select>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea id="deal-notes" rows="3"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary">Save Deal</button>
            </div>
        </form>
    </div>

    <!-- AI Assistant Modal -->
    <div id="ai-modal" class="modal modal-lg">
        <div class="modal-header">
            <h2 id="ai-modal-title"><i class="ph-fill ph-magic-wand text-gradient"></i> AI Assistant</h2>
            <button class="btn-icon close-modal"><i class="ph ph-x"></i></button>
        </div>
        <div class="modal-body">
            <div id="ai-content-area" class="ai-content-area">
                <!-- AI thinking animation or results here -->
                <div class="loader-container" id="ai-loader" style="display:none">
                    <div class="pulse-loader"></div>
                    <p>Gemini is thinking...</p>
                </div>
                <div id="ai-result"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline close-modal">Close</button>
                <button type="button" class="btn btn-primary" id="ai-copy-btn" style="display:none"><i
                        class="ph ph-copy"></i> Copy to Clipboard</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <script type="module" src="js/app.js"></script>
</body>

</html>